<div class="car-analyzer-container">
  <!-- Уведомления об ошибках -->
  <div class="error-container" *ngIf="state.error">
    <div class="error-message">
      <lucide-icon [img]="AlertIcon" class="error-icon"></lucide-icon>
      {{ state.error }}
      <button class="error-close" (click)="clearError()" type="button" aria-label="Закрыть">
        <lucide-icon [img]="CloseIcon"></lucide-icon>
      </button>
    </div>
  </div>

  <!-- Заголовок страницы -->
  <div class="page-header">
    
    <!-- Статус API -->
    <div class="api-status" [class]="getApiStatusClass()" *ngIf="apiHealthStatus">
      <lucide-icon 
        [img]="apiHealthStatus.isOnline ? WifiIcon : WifiOffIcon" 
        class="status-icon">
      </lucide-icon>
      <span class="status-text">{{ getApiStatusText() }}</span>
      <button 
        class="refresh-button" 
        (click)="refreshApiStatus()" 
        type="button"
        title="Обновить статус"
      >
        <lucide-icon [img]="LoaderIcon" class="refresh-icon"></lucide-icon>
      </button>
    </div>
  </div>

  <!-- Компонент загрузки фото -->
  <div class="upload-section" *ngIf="!hasUploadedFile()">
    <app-photo-upload
      [disabled]="state.isAnalyzing"
      (fileUploaded)="onFileUploaded($event)"
      (uploadError)="onUploadError($event)"
    ></app-photo-upload>
  </div>

  <!-- Компонент превью фото -->
  <div class="preview-section" *ngIf="hasUploadedFile()">
    <app-photo-preview
      [uploadedFile]="state.uploadedFile"
      [isAnalyzing]="state.isAnalyzing"
      (removePhoto)="onRemovePhoto()"
      (replacePhoto)="onReplacePhoto()"
    ></app-photo-preview>
  </div>

  <!-- Кнопка анализа -->
  <div class="analysis-controls" *ngIf="hasUploadedFile()">
    <button 
      class="primary-button analysis-button" 
      [disabled]="!canStartAnalysis()"
      (click)="onStartAnalysis()"
      type="button"
    >
      <lucide-icon [img]="SearchIcon" class="button-icon" *ngIf="!state.isAnalyzing"></lucide-icon>
      <lucide-icon [img]="LoaderIcon" class="loading-spinner" *ngIf="state.isAnalyzing"></lucide-icon>
      {{ state.isAnalyzing ? 'Анализируем...' : 'Начать анализ' }}
    </button>
  </div>

  <!-- Компонент отображения результатов -->
  <div class="results-section" *ngIf="state.analysisResult || state.isAnalyzing">
    <app-results-display
      [result]="state.analysisResult"
      [isAnalyzing]="state.isAnalyzing"
      (reset)="onReset()"
    ></app-results-display>
  </div>
</div>