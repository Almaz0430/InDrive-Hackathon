<div class="results-container" *ngIf="hasResults() || isAnalyzing">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="isAnalyzing">
    <div class="loading-content">
      <h3 class="loading-title">Анализируем...</h3>
      <p class="loading-subtitle">Детектируем повреждения автомобиля</p>
    </div>
  </div>

  <!-- Results Display -->
  <div class="results-content" *ngIf="hasResults()">
    <div class="results-header">
      <h3 class="section-title">Результаты анализа</h3>
      <p class="analysis-time">
        Время анализа: {{ formatTimestamp(result!.timestamp) }}
      </p>
    </div>

    <!-- Overall Car Condition -->
    <div class="overall-assessment">
      <div class="assessment-card" [class]="getCarConditionClass()">
        <div class="assessment-icon-wrapper">
          <span class="assessment-emoji">{{ getCarConditionIcon() }}</span>
        </div>
        <div class="assessment-text">
          <h4 class="assessment-title">{{ getCarConditionText() }}</h4>
          <p class="assessment-description">
            {{ result!.totalDamages === 0 
              ? 'Повреждения не обнаружены' 
              : 'Обнаружено повреждений: ' + result!.totalDamages }}
          </p>
          <div class="confidence-info" *ngIf="result!.confidence > 0">
            <span class="confidence-label">Средняя уверенность:</span>
            <span class="confidence-value">{{ formatConfidence(result!.confidence) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Damage Statistics -->
    <div class="damage-stats" *ngIf="result!.totalDamages > 0">
      <h4 class="stats-title">Обнаруженные повреждения</h4>
      <div class="stats-grid">
        <div class="stat-item" *ngIf="result!.damageStats.scratch > 0">
          <span class="stat-icon">{{ analysisService.getDamageIcon('scratch') }}</span>
          <span class="stat-label">Царапины</span>
          <span class="stat-value">{{ result!.damageStats.scratch }}</span>
        </div>
        <div class="stat-item" *ngIf="result!.damageStats.dent > 0">
          <span class="stat-icon">{{ analysisService.getDamageIcon('dent') }}</span>
          <span class="stat-label">Вмятины</span>
          <span class="stat-value">{{ result!.damageStats.dent }}</span>
        </div>
        <div class="stat-item" *ngIf="result!.damageStats.rust > 0">
          <span class="stat-icon">{{ analysisService.getDamageIcon('rust') }}</span>
          <span class="stat-label">Ржавчина</span>
          <span class="stat-value">{{ result!.damageStats.rust }}</span>
        </div>
        <div class="stat-item" *ngIf="result!.damageStats.crack > 0">
          <span class="stat-icon">{{ analysisService.getDamageIcon('crack') }}</span>
          <span class="stat-label">Трещины</span>
          <span class="stat-value">{{ result!.damageStats.crack }}</span>
        </div>
      </div>
    </div>

    <!-- Detailed Detections -->
    <div class="detections-list" *ngIf="result!.detections.length > 0">
      <h4 class="detections-title">Детали повреждений</h4>
      <div class="detection-item" *ngFor="let detection of result!.detections; let i = index">
        <div class="detection-header">
          <span class="detection-icon">{{ analysisService.getDamageIcon(detection.type) }}</span>
          <span class="detection-type">{{ detection.displayText }}</span>
          <span class="detection-confidence">{{ formatConfidence(detection.confidence) }}</span>
        </div>
        <div class="detection-bbox">
          Координаты: ({{ detection.bbox.x1 }}, {{ detection.bbox.y1 }}) - 
          ({{ detection.bbox.x2 }}, {{ detection.bbox.y2 }})
        </div>
      </div>
    </div>

    <!-- Visualization -->
    <div class="visualization-section" *ngIf="hasVisualization()">
      <div class="visualization-header">
        <button 
          class="btn btn-outline visualization-toggle" 
          (click)="toggleVisualization()"
          type="button"
        >
          <lucide-icon [img]="EyeIcon" class="button-icon"></lucide-icon>
          {{ showVisualization ? 'Скрыть визуализацию' : 'Показать визуализацию' }}
        </button>
      </div>
      
      <div class="visualization-content" *ngIf="showVisualization">
        <img 
          [src]="'data:image/jpeg;base64,' + result!.visualization" 
          alt="Визуализация повреждений"
          class="visualization-image"
        />
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button 
        class="btn btn-secondary reset-button" 
        (click)="onReset()"
        type="button"
      >
        <lucide-icon [img]="ResetIcon" class="button-icon"></lucide-icon>
        Загрузить новое фото
      </button>
    </div>
  </div>
</div>

